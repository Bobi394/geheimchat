<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Geheimchat üîê</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #0f1720;
    color: white;
    margin: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  h2 { margin-top: 10px; color:#0ea5a3; }
  #chat {
    width: 90%;
    max-width: 600px;
    background: #13213a;
    border-radius: 10px;
    margin-top: 20px;
    padding: 10px;
    display: flex;
    flex-direction: column;
    height: 80vh;
    overflow: hidden;
  }
  #messages {
  flex: 1 1 auto;        /* flexibel wachsen und schrumpfen */
  overflow-y: auto;
  padding: 12px;
  display: flex;
  flex-direction: column;
  gap: 12px;
  min-height: 0;         /* wichtig f√ºr flexbox, damit scrolling funktioniert */
  }
  .msg {
    max-width: 75%;
    min-width: 120px;          /* Blase auch bei kurzen Nachrichten gro√ü */
    padding: 18px 22px;        /* mehr Innenabstand = gr√∂√üere Blase */
    word-wrap: break-word;
    display: inline-block;
    line-height: 1.4;
    font-size: 16px;
  }
  /* Eigene Nachrichten rechts */
  .me {
    align-self: flex-end;
    color: black;
    border-radius: 24px 24px 4px 24px; /* oben-left, oben-right, unten-right, unten-left */
  }
  /* Andere Nachrichten links */
  .other {
    align-self: flex-start;
    color: white;
    border-radius: 24px 24px 24px 4px; 
  }
  #input-area {
    display: flex;
    gap: 8px;
    padding-top: 5px;
  }
  input, button {
    font-size: 16px;
    padding: 12px;
    border-radius: 24px;
    border: none;
  }
  input { flex: 1; }
  button { background: #0ea5a3; color: black; font-weight: bold; cursor: pointer; }
  a { color: #00ffff; text-decoration: underline; }
</style>
</head>
<body>
<h2>üí¨ Geheimchat mit Firebase</h2>

<div id="chat">
  <div id="messages"></div>
  <div id="input-area">
    <input id="msg" type="text" placeholder="Schreibe eine Nachricht..." />
    <button id="send">Senden ‚û§</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

// Firebase-Konfiguration
const firebaseConfig = {
  apiKey: "AIzaSyDFX3VvV6KL1CJvKwWYSnDNTTfYXC6MFu4",
  authDomain: "geheimchat-eeaaa.firebaseapp.com",
  databaseURL: "https://geheimchat-eeaaa-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "geheimchat-eeaaa",
  storageBucket: "geheimchat-eeaaa.appspot.com",
  messagingSenderId: "276652435",
  appId: "1:276652435:web:8b74170f2bc7f361b37f5e"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const messagesRef = ref(db, "messages");

const messagesDiv = document.getElementById("messages");
const input = document.getElementById("msg");
const sendBtn = document.getElementById("send");

// Benutzername merken
let lastName = localStorage.getItem("geheimchat_username");
let username = prompt("Wie hei√üt du? üë§", lastName || "") || "Unbekannt";
localStorage.setItem("geheimchat_username", username);

// Farben pro Nutzer
const userColors = {};
const colorList = ["#0ea5a3","#3b82f6","#f59e0b","#ef4444","#10b981","#8b5cf6","#f472b6"];
function getUserColor(user){
  if(!userColors[user]){
    userColors[user] = colorList[Object.keys(userColors).length % colorList.length];
  }
  return userColors[user];
}

// Nachrichten anzeigen
onChildAdded(messagesRef, (snapshot) => {
  const msg = snapshot.val();
  const div = document.createElement("div");
  div.className = (msg.user === username) ? "me" : "other";
  div.style.backgroundColor = getUserColor(msg.user);

  // Klickbare Links
  const textWithLinks = msg.text.replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" target="_blank">$1</a>');
  div.innerHTML = `<strong>${msg.user}</strong>: ${textWithLinks}`;

  messagesDiv.appendChild(div);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
});

// Nachricht senden
sendBtn.onclick = () => {
  const text = input.value.trim();
  if(!text) return;
  push(messagesRef, {user: username, text: text, time: Date.now()});
  input.value = "";
};
</script>
</body>
</html>